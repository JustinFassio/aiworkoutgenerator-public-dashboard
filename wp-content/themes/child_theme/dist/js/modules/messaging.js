!function(){"use strict";var e={454:function(e,t,a){a.d(t,{UI:function(){return n}});class s{constructor(){this.initialized=!1}init(){this.initialized||(this.initializeComponents(),this.bindEvents(),this.initialized=!0)}initializeComponents(){this.initializeTabs(),this.initializeTooltips(),this.initializeModals()}bindEvents(){document.addEventListener("click",(e=>{e.target.matches(".athlete-dashboard-toggle")&&this.handleToggle(e),e.target.matches(".athlete-dashboard-modal-trigger")&&this.handleModalTrigger(e)}))}initializeTabs(){document.querySelectorAll(".athlete-dashboard-tabs").forEach((e=>{const t=e.querySelectorAll('[role="tab"]'),a=e.querySelectorAll('[role="tabpanel"]');t.forEach((s=>{s.addEventListener("click",(()=>{t.forEach((e=>e.setAttribute("aria-selected","false"))),a.forEach((e=>e.hidden=!0)),s.setAttribute("aria-selected","true");const n=e.querySelector(`#${s.getAttribute("aria-controls")}`);n&&(n.hidden=!1)}))})),t[0]&&t[0].click()}))}initializeTooltips(){document.querySelectorAll(".athlete-dashboard-tooltip").forEach((e=>{const t=e.getAttribute("data-tooltip");t&&(e.addEventListener("mouseenter",(a=>{const s=document.createElement("div");s.className="athlete-tooltip",s.textContent=t,document.body.appendChild(s);const n=e.getBoundingClientRect();s.style.left=`${n.right+5}px`,s.style.top=n.top+n.height/2-s.offsetHeight/2+"px"})),e.addEventListener("mouseleave",(()=>{document.querySelectorAll(".athlete-tooltip").forEach((e=>e.remove()))})))}))}initializeModals(){document.querySelectorAll(".athlete-dashboard-modal").forEach((e=>{const t=document.createElement("div");t.className="athlete-modal-backdrop",e.before(t);const a=document.createElement("button");a.className="athlete-modal-close",a.innerHTML="Ã—",a.addEventListener("click",(()=>this.closeModal(e))),e.appendChild(a),this.closeModal(e)}))}handleToggle(e){e.preventDefault();const t=document.querySelector(e.target.dataset.target);if(t){const e="none"===t.style.display;t.style.display=e?"block":"none",t.style.height=e?`${t.scrollHeight}px`:"0"}}handleModalTrigger(e){e.preventDefault();const t=e.target.dataset.modal,a=document.getElementById(t);a&&this.openModal(a)}openModal(e){e.style.display="block",e.previousElementSibling?.classList.add("active"),document.body.style.overflow="hidden"}closeModal(e){e.style.display="none",e.previousElementSibling?.classList.remove("active"),document.body.style.overflow=""}static createElement(e,t,a=""){const s=document.createElement(e);return t&&(s.className=t),a&&(s.textContent=a),s}static showLoading(e){const t=s.createElement("div","athlete-loading");return e.appendChild(t),t}static hideLoading(e){e?.remove()}static showError(e,t){const a=s.createElement("div","athlete-error",e);t.appendChild(a),setTimeout((()=>a.remove()),5e3)}}const n=new s;document.addEventListener("DOMContentLoaded",(()=>n.init()))}},t={};function a(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,a),o.exports}a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var s=a(454);const n=new class{constructor(){this.initialized=!1,this.lastMessageCheck=(new Date).toISOString(),this.pollingInterval=null}init(){this.initialized||(this.bindEvents(),this.initializeMessageForms(),this.loadMessages(),this.startMessagePolling(),this.initialized=!0)}bindEvents(){document.addEventListener("submit",(e=>{e.target.matches(".message-form")&&this.handleMessageSubmit(e)})),document.addEventListener("click",(e=>{e.target.matches(".message-delete-btn")&&this.handleMessageDelete(e),e.target.matches(".message-reply-btn")&&this.handleMessageReply(e),e.target.closest(".message-item")&&this.handleMessageClick(e)}))}async initializeMessageForms(){document.querySelectorAll(".recipient-selector").forEach((e=>{this.initializeRecipientSelector(e)}))}async initializeRecipientSelector(e){const t=s.UI.createElement("div","recipient-dropdown"),a=s.UI.createElement("input","recipient-search");a.type="text",a.placeholder="Search recipients...",t.appendChild(a);const n=s.UI.createElement("div","recipient-results");let o;t.appendChild(n),e.parentNode.replaceChild(t,e),a.addEventListener("input",(()=>{clearTimeout(o),o=setTimeout((()=>this.searchRecipients(a.value,n)),250)}))}async searchRecipients(e,t){if(e)try{const a=await fetch(window.athleteDashboard.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"search_recipients",nonce:window.athleteDashboard.nonce,search:e})}),s=await a.json();s.success&&this.renderRecipientResults(s.data,t)}catch(e){console.error("Recipient search error:",e)}else t.innerHTML=""}renderRecipientResults(e,t){t.innerHTML=e.map((e=>`\n                <div class="recipient-option" data-id="${e.id}">\n                    <img src="${e.avatar}" alt="${e.name}" class="recipient-avatar">\n                    <span>${e.name}</span>\n                </div>\n            `)).join(""),t.querySelectorAll(".recipient-option").forEach((e=>{e.addEventListener("click",(()=>this.selectRecipient(e)))}))}selectRecipient(e){const t=e.closest(".recipient-dropdown"),a=t.querySelector(".recipient-search");a.value=e.querySelector("span").textContent,a.dataset.selectedId=e.dataset.id,t.querySelector(".recipient-results").innerHTML=""}async loadMessages(){const e=document.getElementById("messages-container");if(!e)return;const t=s.UI.showLoading(e);try{const t=await fetch(window.athleteDashboard.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"get_messages",nonce:window.athleteDashboard.nonce})}),a=await t.json();a.success?this.updateMessagesList(a.data):this.showMessage("Error loading messages. Please try again.","error",e)}catch(t){this.showMessage("Server error. Please try again later.","error",e),console.error("Messages loading error:",t)}finally{s.UI.hideLoading(t)}}startMessagePolling(){this.pollingInterval&&clearInterval(this.pollingInterval),this.pollingInterval=setInterval((()=>this.checkNewMessages()),3e4)}async checkNewMessages(){try{const e=await fetch(window.athleteDashboard.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"check_new_messages",nonce:window.athleteDashboard.nonce,last_check:this.lastMessageCheck})}),t=await e.json();t.success&&t.data.has_new&&(await this.loadMessages(),this.showNotification("You have new messages")),this.lastMessageCheck=(new Date).toISOString()}catch(e){console.error("New messages check error:",e)}}async handleMessageSubmit(e){e.preventDefault();const t=e.target,a=t.closest(".messaging-container");if(!a)return;const n=s.UI.showLoading(a),o=new FormData(t);try{const e=await fetch(window.athleteDashboard.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"send_message",nonce:window.athleteDashboard.nonce,message_data:JSON.stringify(Object.fromEntries(o))})}),s=await e.json();s.success?(this.showMessage("Message sent successfully!","success",a),t.reset(),await this.loadMessages()):this.showMessage(s.data?.message||"Error sending message. Please try again.","error",a)}catch(e){this.showMessage("Server error. Please try again later.","error",a),console.error("Message submission error:",e)}finally{s.UI.hideLoading(n)}}async handleMessageDelete(e){if(e.preventDefault(),!confirm("Are you sure you want to delete this message?"))return;const t=e.target.dataset.messageId,a=e.target.closest(".message-item");if(!a)return;const n=s.UI.showLoading(a);try{const e=await fetch(window.athleteDashboard.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"delete_message",nonce:window.athleteDashboard.nonce,message_id:t})}),s=await e.json();s.success?(this.showMessage("Message deleted successfully!","success",a),await this.loadMessages()):this.showMessage(s.data?.message||"Error deleting message. Please try again.","error",a)}catch(e){this.showMessage("Server error. Please try again later.","error",a),console.error("Message deletion error:",e)}finally{s.UI.hideLoading(n)}}handleMessageReply(e){e.preventDefault();const t=e.target.closest(".message-item"),a=e.target.dataset.recipientId,s=t.querySelector(".message-subject")?.textContent||"",n=document.querySelector(".recipient-search");n&&(n.dataset.selectedId=a,n.value=t.querySelector(".message-sender")?.textContent||"");const o=document.getElementById("message-subject");o&&(o.value="Re: "+s.replace(/^Re: /,""));const i=document.getElementById("compose-message-form");i&&i.scrollIntoView({behavior:"smooth"})}async handleMessageClick(e){const t=e.target.closest(".message-item"),a=t.dataset.messageId;t.classList.contains("unread")&&await this.markMessageAsRead(a,t),await this.loadMessageContent(a)}async markMessageAsRead(e,t){try{const a=await fetch(window.athleteDashboard.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"mark_message_read",nonce:window.athleteDashboard.nonce,message_id:e})});(await a.json()).success&&(t.classList.remove("unread"),this.updateUnreadCount(-1))}catch(e){console.error("Mark as read error:",e)}}async loadMessageContent(e){const t=document.getElementById("message-content-container");if(!t)return;const a=s.UI.showLoading(t);try{const a=await fetch(window.athleteDashboard.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"get_message_content",nonce:window.athleteDashboard.nonce,message_id:e})}),s=await a.json();s.success?t.innerHTML=s.data.content:this.showMessage("Error loading message content. Please try again.","error",t)}catch(e){this.showMessage("Server error. Please try again later.","error",t),console.error("Message content loading error:",e)}finally{s.UI.hideLoading(a)}}updateMessagesList(e){const t=document.getElementById("messages-list");t&&(t.innerHTML=e.messages),this.updateUnreadCount(e.unread_count)}updateUnreadCount(e){document.querySelectorAll(".unread-count").forEach((t=>{t.textContent="number"==typeof e?parseInt(t.textContent||"0")+e:e}))}showMessage(e,t,a){const n=a.querySelector(".messaging-message")||s.UI.createElement("div","messaging-message");n.className=`messaging-message ${t}`,n.textContent=e,n.parentNode||a.insertBefore(n,a.firstChild),setTimeout((()=>{n.classList.add("fade-out"),setTimeout((()=>n.remove()),300)}),3e3)}async showNotification(e){if("Notification"in window)try{"granted"===await Notification.requestPermission()&&new Notification("Athlete Dashboard",{body:e,icon:"/path/to/notification-icon.png"})}catch(e){console.error("Notification error:",e)}}destroy(){this.pollingInterval&&clearInterval(this.pollingInterval)}};document.addEventListener("DOMContentLoaded",(()=>n.init()))}();